<!doctype html>
<html lang="en" class="h-full antialiased">
  <head>
    <meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Using OpenAI in Rails: A first usecase · AI on Rails</title>
<meta name="title" content="Using OpenAI in Rails: A first usecase · AI on Rails" />
<meta name="description" content="Learn how to integrate OpenAI into your Ruby on Rails application to generate dynamic content and enhance user experience." />
<link href="/images/favicon.ico" rel="icon" type="image/ico" />

    <link href="/stylesheets/tailwind.css" rel="stylesheet" />
    <link href="/stylesheets/code_highlighting.css" rel="stylesheet" />
    <script src="/javascripts/site.js"></script>
    <script defer src="https://cloud.umami.is/script.js" data-website-id="5dde56bc-9822-4d4c-a606-0bd521350c76"></script>
  </head>
  <body class="flex h-full bg-zinc-50">
    <div class="flex w-full">
      <div class="fixed inset-0 flex justify-center sm:px-8">
        <div class="flex w-full max-w-7xl lg:px-8">
          <div class="w-full bg-white ring-1 ring-zinc-100"></div>
        </div>
      </div>
      <div class="relative flex w-full flex-col">
        
<header class="pointer-events-none relative z-50 flex flex-none flex-col">
  <div class="top-0 z-10 h-16 pt-6">
    <div class="sm:px-8 top-6 w-full">
      <div class="mx-auto w-full max-w-7xl lg:px-8">
        <div class="relative px-4 sm:px-8 lg:px-12">
          <div class="mx-auto max-w-2xl lg:max-w-5xl">
            <div class="relative flex gap-4">
              <div class="flex flex-1">
                <div class="h-10 w-10 p-0.5"><a aria-label="Home" class="pointer-events-auto" href="/"><img alt="ai-on-rails.com" fetchpriority="high" width="512" height="512" decoding="async" data-nimg="1" class="h-9 w-9" sizes="2.25rem" src="/images/ai-on-rails.png" style="color: transparent;"></a></div>

              </div>
              <div class="flex flex-1 justify-end md:justify-center">
                <nav class="pointer-events-auto hidden md:block">
                  <ul class="flex rounded-full bg-white/90 px-3 text-sm font-medium text-zinc-800 shadow-lg shadow-zinc-800/5 ring-1 ring-zinc-900/5 backdrop-blur">
                    <li>
                      <a class="relative block px-3 py-2 transition hover:text-teal-500" href="//">Home</a>
                    </li>
                    <li>
                      <a class="relative block px-3 py-2 transition hover:text-teal-500" href="/articles/">Articles</a>
                    </li>
                    <li>
                      <a class="relative block px-3 py-2 transition hover:text-teal-500" href="/author/">Author</a>
                    </li>
                  </ul>
                </nav>
              </div>
              <div class="flex justify-end md:flex-1"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>

        <main clas="flex-auto">
          <div class="sm:px-8 mt-12 lg:mt-16">
            <div class="relative px-4 sm:px-8 lg:px-12">
              <div class="mx-auto w-full max-w-7xl lg:px-8">
                <div class="relative px-4 sm:px-8 lg:px-12">
                  <div class="mx-auto max-w-2xl lg:max-w-5xl">
                      <div class="mx-auto max-w-2xl lg:max-w-5xl">
    <div class="xl:relative">
      <div class="mx-auto max-w-2xl">
        <div id="prose-content" class="prose">
          <h1 id="using-openai-in-rails-a-first-usecase">Using OpenAI in Rails: A first usecase</h1>

<p>OpenAI has revolutionized the way we interact with artificial intelligence with its ChatGPT product.<br />
From generating human-like text to providing insightful recommendations, OpenAI’s language models have a wide range of applications.<br />
Integrating OpenAI into a Ruby on Rails application opens up numerous possibilities for enhancing user experience, automating tasks, and generating dynamic content.</p>

<p>In this blog post, we’ll walk through a simple use case of using OpenAI in a Rails application: generating an outline for a blog post.</p>

<h2 id="setting-up-openai-in-rails">Setting Up OpenAI in Rails</h2>

<h3 id="adding-necessary-gems-to-the-gemfile">Adding necessary gems to the Gemfile</h3>

<p>To start using OpenAI in your Rails application, you’ll need to add the <a href="https://github.com/alexrudall/ruby-openai" target="_blank"><code>ruby-openai</code></a> gem to your Gemfile.<br />
This gem provides a simple interface for interacting with the OpenAI API. Open your Gemfile and add the following line:</p>

<div class="highlight"><pre class="highlight ruby"><code><span class="n">gem</span> <span class="s1">'ruby-openai'</span>
</code></pre></div>
<p>After adding the gem, run bundle install to install it:</p>

<div class="highlight"><pre class="highlight shell"><code>bundle <span class="nb">install</span>
</code></pre></div>
<h3 id="configuring-openai-api-credentials">Configuring OpenAI API credentials</h3>

<p>Once the gem is installed, you’ll need to configure it with your OpenAI API key. You can obtain an API key by signing up on the OpenAI website and creating an <a href="https://platform.openai.com/api-keys" target="_blank">API token</a>.</p>

<p>Create a new initializer file in <code>config/initializers/openai.rb</code> and add the following code to set up your API key:</p>

<div class="highlight"><pre class="highlight ruby"><code><span class="no">OpenAI</span><span class="p">.</span><span class="nf">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">access_token</span> <span class="o">=</span> <span class="no">ENV</span><span class="p">.</span><span class="nf">fetch</span><span class="p">(</span><span class="s2">"OPENAI_ACCESS_TOKEN"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">organization_id</span> <span class="o">=</span> <span class="no">ENV</span><span class="p">.</span><span class="nf">fetch</span><span class="p">(</span><span class="s2">"OPENAI_ORGANIZATION_ID"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>For security reasons, it’s best to store your API key in an environment variable. You can add the key to your <code>.env</code> file (if you are using the <a href="https://github.com/bkeepers/dotenv" target="_blank"><code>dotenv-rails</code></a> gem) or set it directly in your environment. Here’s an example of how to add it to your <code>.env</code> file:</p>

<div class="highlight"><pre class="highlight shell"><code><span class="nv">OPENAI_ACCESS_TOKEN</span><span class="o">=</span>your_api_key_here
<span class="nv">OPENAI_ORGANIZATION_ID</span><span class="o">=</span>your_organization_id_here
</code></pre></div>
<p>Make sure to add .env to your .gitignore file to prevent it from being committed to your version control system.</p>

<h2 id="implementing-the-first-use-case">Implementing the First Use Case</h2>

<p>Example use case: Generate an outline for a blog post</p>

<h2 id="scaffold-a-post-model-with-title-content-and-outline">Scaffold a post model with title, content and outline</h2>

<p>First, let’s generate a scaffold for the Post model. This will create the necessary files for our posts, including the model, controller, and views. Run the following command:</p>

<div class="highlight"><pre class="highlight shell"><code>rails generate scaffold Post title:string content:text outline:text
rails db:migrate
</code></pre></div>
<p>This command creates a Post model with <code>title</code>, <code>content</code>, and <code>outline</code> attributes. It also sets up the necessary database table and routes.</p>

<h2 id="hooking-up-the-openai-call-in-an-activerecord-callback">Hooking up the OpenAI call in an ActiveRecord callback</h2>

<p>Now, let’s use OpenAI to generate an outline for the blog post automatically whenever a new post is created. We’ll do this by adding a callback to our Post model.</p>

<p>Open the <code>app/models/post.rb</code> file and add the following code:</p>

<div class="highlight"><pre class="highlight ruby"><code><span class="c1"># app/models/post.rb</span>
<span class="k">class</span> <span class="nc">Post</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span>
    <span class="ss">length: </span><span class="p">{</span><span class="ss">minimum: </span><span class="mi">10</span><span class="p">,</span> <span class="ss">maximum: </span><span class="mi">80</span><span class="p">}</span>

  <span class="n">after_validation</span> <span class="ss">:generate_outline</span><span class="p">,</span> <span class="ss">on: :create</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">generate_outline</span>
    <span class="n">system_prompt</span> <span class="o">=</span> <span class="o">&lt;&lt;~</span><span class="no">PROMPT</span><span class="sh">
Generate an outline for blog post based on a
title to help the user structure their thoughts.
</span><span class="no">    PROMPT</span>

    <span class="nb">self</span><span class="p">.</span><span class="nf">outline</span> <span class="o">=</span> <span class="no">OpenAI</span><span class="o">::</span><span class="no">Client</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">chat</span><span class="p">(</span>
      <span class="ss">parameters: </span><span class="p">{</span>
        <span class="ss">model: </span><span class="s2">"gpt-3.5-turbo"</span><span class="p">,</span>
        <span class="ss">messages: </span><span class="p">[</span>
          <span class="p">{</span><span class="ss">role: </span><span class="s2">"system"</span><span class="p">,</span> <span class="ss">content: </span><span class="n">system_prompt</span><span class="p">},</span>
          <span class="p">{</span><span class="ss">role: </span><span class="s2">"user"</span><span class="p">,</span> <span class="ss">content: </span><span class="n">title</span><span class="p">}</span>
        <span class="p">],</span>
        <span class="ss">temperature: </span><span class="mf">0.8</span>
      <span class="p">}</span>
    <span class="p">).</span><span class="nf">dig</span><span class="p">(</span><span class="s2">"choices"</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"message"</span><span class="p">,</span> <span class="s2">"content"</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h2 id="conclusion">Conclusion</h2>

<p>This integration of OpenAI into a Ruby on Rails application is only a small glimpse of the possibilities that AI can bring to your projects. By leveraging the power of OpenAI’s language models, you can automate tasks, generate dynamic content, and enhance user experience in your Rails applications. Experiment with different use cases and explore the full potential of AI in your projects.</p>

<p>Further ideas for enhancing this use case include:</p>

<ul>
  <li>Generating the outline asynchronously using Active Job</li>
  <li>Finetuning the prompt for a better outline generation</li>
</ul>

<!-- table of contents (html disclosure + kramdown {:toc}) -->
<details class="italic" open=""><summary>Table of Contents</summary><aside>
<ul id="markdown-toc">
  <li><a href="#setting-up-openai-in-rails" id="markdown-toc-setting-up-openai-in-rails">Setting Up OpenAI in Rails</a>    <ul>
      <li><a href="#adding-necessary-gems-to-the-gemfile" id="markdown-toc-adding-necessary-gems-to-the-gemfile">Adding necessary gems to the Gemfile</a></li>
      <li><a href="#configuring-openai-api-credentials" id="markdown-toc-configuring-openai-api-credentials">Configuring OpenAI API credentials</a></li>
    </ul>
  </li>
  <li><a href="#implementing-the-first-use-case" id="markdown-toc-implementing-the-first-use-case">Implementing the First Use Case</a></li>
  <li><a href="#scaffold-a-post-model-with-title-content-and-outline" id="markdown-toc-scaffold-a-post-model-with-title-content-and-outline">Scaffold a post model with title, content and outline</a></li>
  <li><a href="#hooking-up-the-openai-call-in-an-activerecord-callback" id="markdown-toc-hooking-up-the-openai-call-in-an-activerecord-callback">Hooking up the OpenAI call in an ActiveRecord callback</a></li>
  <li><a href="#conclusion" id="markdown-toc-conclusion">Conclusion</a></li>
</ul>

  </aside></details>

        </div>
      </div>
    </div>
  </div>

                  </div>
                </div>
              </div>
            </div>
            <div class="mx-auto w-full max-w-7xl lg:px-8"></div>
          </div>
        </main>
        
<footer class="mt-32 flex-none">
  <div class="sm:px-8">
    <div class="mx-auto w-full max-w-7xl lg:px-8">
      <div class="border-t border-zinc-100 pb-16 pt-10">
        <div class="relative px-4 sm:px-8 lg:px-12">
          <div class="mx-auto max-w-2xl lg:max-w-5xl">
            <div class="flex flex-col items-center justify-between gap-6 sm:flex-row">
              <div class="flex flex-wrap justify-center gap-x-6 gap-y-1 text-sm font-medium text-zinc-800">
                  <a class="hover:text-teal-500" href="/">Home</a>
                  <a class="hover:text-teal-500" href="/articles">Articles</a>
                  <a class="hover:text-teal-500" href="/author">Author</a>
              </div>
              <p class="text-sm text-zinc-400">© <!-- -->2024<!-- --> No rights reserved.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</footer>

      </div>
    </div>
  </body>
</html>
